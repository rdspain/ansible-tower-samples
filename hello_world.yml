#ayalat Abril 2020
---
- name: Control de comunicación con servidores
  hosts: localhost
  gather_facts: false
  tasks:
    - name: notificar_slack
      shell: ansible all -m setup | grep " UNREACHABLE\!" | awk '{print $1}'
      register: stp

    - debug: msg={{ stp.stdout_lines }}


    - name: Avisaré por Slack en \#lab de los servers caídos
      slack:
        domain: "{{ slack_domain }}"
        token: "{{ slack_token_lab }}"
        msg: "ANSIBLE AVISO !!! {{ stp.stdout_lines }}."
      when: ( stp.stdout != "" )
      delegate_to: localhost

